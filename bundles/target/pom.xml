<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
   <modelVersion>4.0.0</modelVersion>
   <parent>
      <groupId>org.jscsi</groupId>
      <artifactId>pom</artifactId>
      <version>2.5.3-SNAPSHOT</version>
      <relativePath>../../pom.xml</relativePath>
   </parent>

   <artifactId>target</artifactId>
   <name>Target</name>
   <packaging>jar</packaging>

   <url>http://disy.github.com/jSCSI/</url>
   <scm>
      <url>git@github.com:disy/jSCSI.git</url>
      <connection>scm:git:git@github.com:disy/jSCSI.git</connection>
      <developerConnection>scm:git:git@github.com:disy/jSCSI.git</developerConnection>
   </scm>

   <profiles>
      <profile>
         <activation>
            <activeByDefault>true</activeByDefault>
         </activation>
         <build>
            <plugins>
               <plugin>
                  <groupId>org.apache.maven.plugins</groupId>
                  <artifactId>maven-assembly-plugin</artifactId>
                  <configuration>
                     <descriptors>
                        <descriptor>src/main/assembly/jarAssembly.xml</descriptor>
                     </descriptors>
                     <archive>
                        <manifest>
                           <mainClass>org.jscsi.target.TargetServer</mainClass>
                        </manifest>
                     </archive>
                  </configuration>
               </plugin>
               <plugin>
                 <groupId>org.apache.maven.plugins</groupId>
                 <artifactId>maven-shade-plugin</artifactId>
                 <version>2.3</version>
                 <configuration>
                   <createDependencyReducedPom>false</createDependencyReducedPom>
                   <filters>
                     <filter>
                       <artifact>*:*</artifact>
                       <excludes>
                         <exclude>META-INF/*.SF</exclude>
                         <exclude>META-INF/*.DSA</exclude>
                         <exclude>META-INF/*.RSA</exclude>
                         <exclude>about.html</exclude>
                       </excludes>
                     </filter>
                   </filters>
                   <shadedArtifactAttached>true</shadedArtifactAttached>
                   <transformers>
                     <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                       <manifestEntries>
                         <Main-Class>org.jscsi.target.TargetServer</Main-Class>
                         <Implementation-Build>${buildNumber}</Implementation-Build>
                         <Implementation-Version>${project.version}</Implementation-Version>
                         <Build-Date>${timestamp}</Build-Date>
                       </manifestEntries>
                     </transformer>
                     <transformer implementation="org.apache.maven.plugins.shade.resource.ServicesResourceTransformer"/>
                     <transformer implementation="org.apache.maven.plugins.shade.resource.ApacheLicenseResourceTransformer"/>
                     <transformer implementation="org.apache.maven.plugins.shade.resource.ApacheNoticeResourceTransformer"/>
                     <transformer implementation="org.apache.maven.plugins.shade.resource.IncludeResourceTransformer">
                       <resource>logback.xml</resource>
                       <file>bundles/commons/src/main/resources/logback.xml</file>
                     </transformer>
                   </transformers>
                 </configuration>
                 <executions>
                   <execution>
                     <id>jar-with-dependencies</id>
                     <phase>package</phase>
                     <goals>
                       <goal>shade</goal>
                     </goals>
                     <configuration>
                       <shadedClassifierName>jar-with-dependencies</shadedClassifierName>
                     </configuration>
                   </execution>
                 </executions>
               </plugin>
            </plugins>
         </build>
      </profile>
      <profile>
         <id>osgi-bundle</id>
         <build>
            <plugins>
               <plugin>
                  <groupId>org.apache.felix</groupId>
                  <artifactId>maven-bundle-plugin</artifactId>
                  <version>2.4.0</version>
                  <extensions>true</extensions>
                  <configuration>
                     <instructions>
                        <Bundle-Activator>org.jscsi.target.Activator</Bundle-Activator>
                        <Bundle-SymbolicName>${project.artifactId}-bundle</Bundle-SymbolicName>
                        <Export-Package>org.jscsi.target.*</Export-Package>
                        <Import-Package>
                           org.osgi.framework,
                           javax.crypto,
                           javax.crypto.spec,
                           javax.lang.model.type,
                           javax.management,
                           javax.naming,
                           javax.net.ssl,
                           javax.security.auth.x500,
                           javax.sql,
                           javax.sql.rowset.serial,
                           javax.xml.bind,
                           javax.xml.namespace,
                           javax.xml.parsers,
                           javax.xml.transform,
                           javax.xml.transform.dom,
                           javax.xml.transform.stream,
                           javax.xml.validation,
                           javax.xml.xpath,
                           org.osgi.util.tracker,
                           org.w3c.dom,
                           org.xml.sax,
                           org.xml.sax.helpers
                        </Import-Package>
                        <Embed-Dependency>*;scope=compile|runtime;inline=false</Embed-Dependency>
                        <Embed-Transitive>true</Embed-Transitive>
                     </instructions>
                  </configuration>
               </plugin>
            </plugins>
         </build>
      </profile>
   </profiles>
   <dependencies>
      <dependency>
         <groupId>org.jscsi</groupId>
         <artifactId>commons</artifactId>
         <version>2.5.3-SNAPSHOT</version>
      </dependency>
      <dependency>
         <groupId>org.apache.jclouds</groupId>
         <artifactId>jclouds-allblobstore</artifactId>
         <version>1.7.0</version>
      </dependency>
      <dependency>
         <groupId>org.apache.jclouds.provider</groupId>
         <artifactId>aws-s3</artifactId>
         <version>1.7.0</version>
      </dependency>
      <dependency>
         <groupId>org.apache.jclouds.api</groupId>
         <artifactId>filesystem</artifactId>
         <version>1.7.0</version>
      </dependency>
      <dependency>
         <groupId>org.osgi</groupId>
         <artifactId>org.osgi.core</artifactId>
         <version>4.3.0</version>
      </dependency>
   </dependencies>

</project>
